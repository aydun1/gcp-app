<div *ngIf="customer$ | async as customer" class="content">
  <div class="top-buttons">
    <a mat-stroked-button (click)="goBack()"><mat-icon>arrow_back</mat-icon>Back to customers</a>
    <button mat-stroked-button [matMenuTriggerFor]="menu" [matMenuTriggerData]="{customer: customer.accountnumber}">
      {{ site || 'All sites'}}
    </button>
  </div>
  <div class="inner">
    <h2>{{ customer.name || 'Unnamed customer' }}</h2>
    <p>{{ customer.accountnumber }}</p>
    <div class="cards">
      <div class="status-card">
        <h3>
          Pallets with customer
        </h3>
        <dl>
          <dt>Loscams</dt>
          <dd>{{ pallets ? pallets.Loscam  : '...' }}</dd>
          <dt>Cheps</dt>
          <dd>{{ pallets ? pallets.Chep  : '...' }}</dd>
          <dt>Plains</dt>
          <dd>{{ pallets ? pallets.Plain  : '...' }}</dd>
        </dl>
      </div>
      <div class="status-card">
        <h3>
          Cages
        </h3>
        <dl>
          <dt>Weight</dt>
          <dd>{{ cages ? cages.weight +' kg'  : '...' }}</dd>
        </dl>
      </div>
    </div>
    <div>
      <gcp-big-button [target]="[]" (click)="openPalletDialog(customer)">Transfer Pallets</gcp-big-button>
      <gcp-big-button [target]="[]" (click)="openRecyclingDialog(customer)">Manage Recycling</gcp-big-button>
    </div>
  </div>
</div>

<mat-menu #menu="matMenu" xPosition="before" >
  <ng-template matMenuContent let-customer="customer">
    <button mat-menu-item  (click)="setSite(null)">
      <span>All sites</span>
    </button>
    <button mat-menu-item *ngFor="let site of sites" (click)="setSite(site.fields.Title)">
      <span>{{ site.fields.Title }}</span>
    </button>
    <button mat-menu-item (click)="openSiteDialog(customer)">
      <mat-icon>add</mat-icon>
      <span>Add/edit sites</span>
    </button>
  </ng-template>
</mat-menu>