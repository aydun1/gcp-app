
<button mat-raised-button type="button" color="primary" *ngIf="statusId === 0" (click)="openCustomerPicker(cages)" [disabled]="loading | async" class="action">Assign to customer</button>
<button mat-raised-button type="button" color="primary" *ngIf="statusId === 1" (click)="markWithCustomer(cages)" [disabled]="loading | async" class="action">Deliver to customer</button>
<button mat-raised-button type="button" color="primary" *ngIf="statusId === 2" (click)="markAsCollected(cages)" [disabled]="loading | async" class="action">Collect from customer</button>
<button mat-raised-button type="button" color="primary" *ngIf="statusId === 3 && status !== 'Ready for delivery to Polymer'" (click)="markWithProcessing(cages)" [disabled]="loading | async" class="action">Send to local processing</button>
<button mat-raised-button type="button" color="primary" *ngIf="statusId === 3 && status !== 'Ready for delivery to local processing'" (click)="markWithPolymer(cages)" [disabled]="loading | async" class="action">Send to Polymer</button>
<button mat-raised-button type="button" color="primary" *ngIf="statusId === 4" (click)="collectFromProcessing(cages)" [disabled]="loading | async" class="action">Return from local processing</button>
<button mat-raised-button type="button" color="primary" *ngIf="statusId === 5" (click)="collectFromPolymer(cages)" [disabled]="loading | async" class="action">Return from Polymer</button>
<button mat-raised-button type="button" color="primary" *ngIf="statusId === 6" (click)="markAvailable(cages)" [disabled]="loading | async" class="action">Set cage as available</button>
<button mat-icon-button type="button" [matMenuTriggerFor]="menu" class="menu" *ngIf="cages.length > 0 && !hasComplete"><mat-icon>more_vert</mat-icon></button>
<mat-menu #menu="matMenu" xPosition="before">
  <ng-template matMenuContent>
    <button type="button" mat-menu-item (click)="openEditDialog(cages)" [disabled]="cages.length > 1">
      <mat-icon>edit</mat-icon>
      <span>Edit</span>
    </button>
    <button type="button" mat-menu-item (click)="undo(cages)" [disabled]="statusId === 0">
      <mat-icon>undo</mat-icon>
      <span>Undo</span>
    </button>
    <button type="button" mat-menu-item (click)="reset(cages)" [disabled]="statusId === 0">
      <mat-icon>restart_alt</mat-icon>
      <span>Reset</span>
    </button>
    <button type="button" mat-menu-item (click)="dehire(cages)" [disabled]="statusId !== 0">
      <mat-icon>assignment_return</mat-icon>
      <span>Dehire</span>
    </button>
    <button type="button" mat-menu-item (click)="readyForCollection(cages)" *ngIf="statusId === 2">
      <mat-icon>flag</mat-icon>
      <span>Ready for collection</span>
    </button>
    <button type="button" mat-menu-item [matMenuTriggerFor]="readyMenu" *ngIf="statusId === 3">
      <mat-icon>flag</mat-icon>
      <span>Ready for processing</span>
    </button>
    <button type="button" mat-menu-item [matMenuTriggerFor]="branchesMenu">
      <mat-icon>location_city</mat-icon>
      <span>Change branch</span>
    </button>
    <button type="button" mat-menu-item [matMenuTriggerFor]="materialsMenu">
      <mat-icon>recycling</mat-icon>
      <span>Pick material</span>
    </button>
    <button type="button" mat-menu-item [matMenuTriggerFor]="depotMenu" [disabled]="statusId !== 0">
      <mat-icon>local_shipping</mat-icon>
      <span>Transfer to depot</span>
    </button>
  </ng-template>
</mat-menu>

<mat-menu #materialsMenu="matMenu">
  <button type="button" *ngFor="let material of materials" mat-menu-item (click)="setMaterial(cages, material)" [disabled]="material['code'] === cageMaterial" [value]="material['code']">{{ material['name'] }}</button>
</mat-menu>

<mat-menu #branchesMenu="matMenu">
  <button type="button" *ngFor="let branch of branches" mat-menu-item (click)="setBranch(cages, branch)" [disabled]="branch === cageBranch">{{ branch }}</button>
</mat-menu>

<mat-menu #readyMenu="matMenu">
  <button type="button" mat-menu-item (click)="markReadyForPolymer(cages)">Polymer</button>
  <button type="button" mat-menu-item (click)="markReadyForProcessing(cages)">Local</button>
</mat-menu>

<mat-menu #depotMenu="matMenu">
  <button type="button" *ngFor="let depot of depots" mat-menu-item (click)="setDepot(cages, depot.fields.Title)">{{ depot.fields.Title }}</button>
  <button type="button" mat-menu-item (click)="openSiteDialog()">
    <mat-icon>add</mat-icon>
    <span>Add/edit depots</span>
  </button>
</mat-menu>